<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>percipio-axios-client.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/martinholden-skillsoft/percipio-axios.git" target="_blank" class="menu-item" id="repository" >Github repo</a></h2><h3>Classes</h3><ul><li><a href="PercipioAxiosClient.html">PercipioAxiosClient</a><ul class='methods'><li data-type='method' style='display: none;'><a href="PercipioAxiosClient.html#.isPercipioAxiosClientError">isPercipioAxiosClientError</a></li><li data-type='method' style='display: none;'><a href="PercipioAxiosClient.html#buildHeaders">buildHeaders</a></li><li data-type='method' style='display: none;'><a href="PercipioAxiosClient.html#buildPath">buildPath</a></li><li data-type='method' style='display: none;'><a href="PercipioAxiosClient.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="PercipioAxiosClient.html#get">get</a></li><li data-type='method' style='display: none;'><a href="PercipioAxiosClient.html#head">head</a></li><li data-type='method' style='display: none;'><a href="PercipioAxiosClient.html#options">options</a></li><li data-type='method' style='display: none;'><a href="PercipioAxiosClient.html#patch">patch</a></li><li data-type='method' style='display: none;'><a href="PercipioAxiosClient.html#post">post</a></li><li data-type='method' style='display: none;'><a href="PercipioAxiosClient.html#put">put</a></li><li data-type='method' style='display: none;'><a href="PercipioAxiosClient.html#sendRequest">sendRequest</a></li></ul></li><li><a href="PercipioAxiosClientError.html">PercipioAxiosClientError</a></li><li><a href="PropertyInvalidError.html">PropertyInvalidError</a></li><li><a href="PropertyRequiredError.html">PropertyRequiredError</a></li></ul><h3>Global</h3><ul><li><a href="global.html#createAxiosInstance">createAxiosInstance</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">percipio-axios-client.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { v4: uuidv4, validate: uuidValidate } = require('uuid');
const jwtdecode = require('jwt-decode');
const validUrl = require('valid-url');
const _ = require('lodash');

const errors = require('./errors');
const axiosExtras = require('./axiosextras');

/**
 * An Axios Client that provides a consistent approach for making Percipio API requests.
 * @category Percipio Client
 */
class PercipioAxiosClient {
  /**
   * Creates an instance of PercipioAxiosClient.
   * @param {Object} configuration - The configuration
   * @param {String} configuration.baseURL - The base URL for the API
   * @param {String} configuration.orgId - The organization ID
   * @param {String} configuration.bearer - The bearer token
   * @param {Object} [configuration.instance] - The Axios instance to use,
   *  defaults to using {@link createAxiosInstance}.
   * @param {Object} [configuration.resourcePlaceholders={orgId: configuration.orgId}]
   *   Used to replace placeholders in the resource path.
   * @throws {PropertyRequiredError} baseURL is a required configuration property
   * @throws {PropertyInvalidError} baseURL is invalid, it must be a valid https URL
   * @throws {PropertyRequiredError} orgId is a required configuration property
   * @throws {PropertyInvalidError} orgId is invalid, it must be a uuid
   * @throws {PropertyRequiredError} bearer is a required configuration property
   * @throws {PropertyInvalidError} bearer is invalid, it must be a JWT
   * @throws {PropertyInvalidError} instance is invalid, it must be an instance of Axios
   * @memberof PercipioAxiosClient
   */
  constructor(configuration = {}) {
    this.configuration = _.merge({ resourcePlaceholders: {} }, _.cloneDeep(configuration));

    if (!('baseURL' in this.configuration)) {
      throw new errors.PropertyRequiredError('baseURL is a required configuration property');
    }

    if (!validUrl.isHttpsUri(this.configuration.baseURL)) {
      throw new errors.PropertyInvalidError('baseURL is invalid, it must be a valid https URL');
    }

    if (!('orgId' in this.configuration)) {
      throw new errors.PropertyRequiredError('orgId is a required configuration property');
    }

    if (!uuidValidate(this.configuration.orgId)) {
      throw new errors.PropertyInvalidError('orgId is invalid, it must be a uuid');
    }

    if (!('bearer' in this.configuration)) {
      throw new errors.PropertyRequiredError('bearer is a required configuration property');
    }

    try {
      jwtdecode(this.configuration.bearer);
    } catch (error) {
      throw new errors.PropertyInvalidError('bearer is invalid, it must be a JWT', error);
    }

    this.configuration = _.merge(this.configuration, {
      resourcePlaceholders: { orgId: this.configuration.orgId },
    });

    this.id = uuidv4();

    this.defaultHeaders = {
      'content-type': 'application/json',
      authorization: `Bearer ${this.configuration.bearer}`,
    };

    this.instance = this.configuration.instance || axiosExtras.createAxiosInstance();

    const check =
      typeof this.instance.create === 'function' &amp;&amp;
      typeof this.instance.request === 'function' &amp;&amp;
      typeof this.instance.interceptors === 'object';

    if (!check) {
      throw new errors.PropertyInvalidError('instance is invalid, it must be an instance of Axios');
    }
  }

  /**
   * Check if the passed object is a PercipioAxiosClientError.
   *
   * @static
   * @param {Object} obj
   * @return {Boolean}
   * @memberof PercipioAxiosClient
   */
  static isPercipioAxiosClientError(obj) {
    return obj !== null &amp;&amp; typeof obj === 'object' &amp;&amp; obj.isPercipioAxiosClientError === true;
  }

  /**
   * Builds the path for the resource, replacing any placeholders
   * with the values from configuration.resourcePlaceholders.
   *
   * @param {String} resource - The resource path template
   * @return {String}
   * @throws {PropertyRequiredError} {placeHolder} is a required
   *                                 configuration.resourcePlaceholders property
   * @memberof PercipioAxiosClient
   */
  buildPath(resource) {
    return resource.replace(/{([-_a-zA-Z0-9[\]]+)}/g, (original, placeHolder) => {
      if (placeHolder in this.configuration.resourcePlaceholders) {
        return this.configuration.resourcePlaceholders[placeHolder];
      }

      throw new errors.PropertyRequiredError(
        `${placeHolder} is a required configuration.resourcePlaceholders property`
      );
    });
  }

  /**
   * Builds the headers for the request, combining the default headers with the extra headers.
   * All keys are normalized to lowercase.
   *
   * @param {Object} headers - The extra headers to send with the request, as key/value pairs.
   * @return {Object}
   * @throws {PropertyInvalidError} The authorization header is not valid. Value: {authorization}
   *                                if the authorization header does not start with 'Bearer'
   * @memberof PercipioAxiosClient
   */
  buildHeaders(headers) {
    const lowercaseKeys = (obj) =>
      Object.keys(obj).reduce((acc, key) => {
        acc[key.toLowerCase()] = obj[key];
        return acc;
      }, {});

    const result = _.merge({}, this.defaultHeaders, headers ? lowercaseKeys(headers) : {});

    if ('authorization' in result &amp;&amp; !result.authorization.startsWith('Bearer ')) {
      throw new errors.PropertyInvalidError(
        `The authorization header is not valid. Value: ${result.authorization}`
      );
    }

    return result;
  }

  /**
   * Sends the request to the API.
   *
   * @param {Object} config
   * @param {String} config.method - The HTTP method.
   * @param {String} config.resource - The resource path to send the request to.
   * @param {Object} [config.params={}] - The params to send with the request.
   * @param {Object} [config.data={}] - The data to send with the request.
   * @param {Object} [config.headers={}] - The headers to send with the request,
   *                                       these will be merged with the default
   *                                       headers (authorization and content-type)
   * @param {*} [config.other] - Any other Axios Request Config properties to pass to the request.
   *                      See {@link https://github.com/axios/axios#request-config|Axios Request Config}
   * @return {Promise}
   * @throws {PropertyRequiredError} method is a required configuration property
   * @throws {PropertyRequiredError} resource is a required configuration property
   * @memberof PercipioAxiosClient
   */
  sendRequest(config) {
    const { method, resource, params = {}, data = {}, headers, ...other } = config;

    return new Promise((resolve, reject) => {
      if (!method) {
        reject(new errors.PropertyRequiredError('method is a required configuration property'));
      }

      if (!resource) {
        reject(new errors.PropertyRequiredError('resource is a required configuration property'));
      }

      const requestConfig = {
        baseURL: this.configuration.baseURL,
        method,
        ...other,
      };

      try {
        requestConfig.url = this.buildPath(resource);
        requestConfig.headers = this.buildHeaders(headers);
      } catch (error) {
        reject(error);
      }

      if (!_.isEmpty(data)) {
        requestConfig.data = _.omitBy(data, _.isNil);
      }

      if (!_.isEmpty(params)) {
        requestConfig.params = _.omitBy(params, _.isNil);
      }

      this.instance
        .request(requestConfig)
        .then((response) => {
          resolve(response);
        })
        .catch((err) => {
          reject(err);
        });
    });
  }

  /**
   * Sends a delete request to the API.
   *
   * @param {Object} config
   * @param {String} config.resource - The resource path to send the request to.
   * @param {Object} [config.params={}] - The params to send with the request.
   * @param {Object} [config.data={}] - The data to send with the request.
   * @param {Object} [config.headers={}] - The headers to send with the request,
   *                                       these will be merged with the default
   *                                       headers (authorization and content-type)
   * @param {*} [config.other] - Any other Axios Request Config properties to pass to the request.
   *                      See {@link https://github.com/axios/axios#request-config|Axios Request Config}
   * @return {Promise}
   * @throws {PropertyInvalidError} method cannot be overridden
   * @memberof PercipioAxiosClient
   */
  delete({ resource, params, data, headers, ...other }) {
    return new Promise((resolve, reject) => {
      const method = 'delete';
      if (other.method &amp;&amp; other.method !== method) {
        reject(new errors.PropertyInvalidError('method cannot be overridden'));
      }

      this.sendRequest({ method, resource, params, data, headers, ...other })
        .then((response) => {
          resolve(response);
        })
        .catch((err) => {
          reject(err);
        });
    });
  }

  /**
   * Sends a get request to the API.
   *
   * @param {Object} config
   * @param {String} config.resource - The resource path to send the request to.
   * @param {Object} [config.params={}] - The params to send with the request.
   * @param {Object} [config.data={}] - The data to send with the request.
   * @param {Object} [config.headers={}] - The headers to send with the request,
   *                                       these will be merged with the default
   *                                       headers (authorization and content-type)
   * @param {*} [config.other] - Any other Axios Request Config properties to pass to the request.
   *                      See {@link https://github.com/axios/axios#request-config|Axios Request Config}
   * @throws {PropertyInvalidError} method cannot be overridden
   * @return {Promise}
   * @memberof PercipioAxiosClient
   */
  get({ resource, params, data, headers, ...other }) {
    return new Promise((resolve, reject) => {
      const method = 'get';
      if (other.method &amp;&amp; other.method !== method) {
        reject(new errors.PropertyInvalidError('method cannot be overridden'));
      }

      this.sendRequest({ method, resource, params, data, headers, ...other })
        .then((response) => {
          resolve(response);
        })
        .catch((err) => {
          reject(err);
        });
    });
  }

  /**
   * Sends a head request to the API.
   *
   * @param {Object} config
   * @param {String} config.resource - The resource path to send the request to.
   * @param {Object} [config.params={}] - The params to send with the request.
   * @param {Object} [config.data={}] - The data to send with the request.
   * @param {Object} [config.headers={}] - The headers to send with the request,
   *                                       these will be merged with the default
   *                                       headers (authorization and content-type)
   * @param {*} [config.other] - Any other Axios Request Config properties to pass to the request.
   *                      See {@link https://github.com/axios/axios#request-config|Axios Request Config}  * @throws {PropertyInvalidError} method cannot be overridden
   * @return {Promise}
   * @memberof PercipioAxiosClient
   */
  head({ resource, params, data, headers, ...other }) {
    return new Promise((resolve, reject) => {
      const method = 'head';
      if (other.method &amp;&amp; other.method !== method) {
        reject(new errors.PropertyInvalidError('method cannot be overridden'));
      }

      this.sendRequest({ method, resource, params, data, headers, ...other })
        .then((response) => {
          resolve(response);
        })
        .catch((err) => {
          reject(err);
        });
    });
  }

  /**
   * Sends an options request to the API.
   *
   * @param {Object} config
   * @param {String} config.resource - The resource path to send the request to.
   * @param {Object} [config.params={}] - The params to send with the request.
   * @param {Object} [config.data={}] - The data to send with the request.
   * @param {Object} [config.headers={}] - The headers to send with the request,
   *                                       these will be merged with the default
   *                                       headers (authorization and content-type)
   * @param {*} [config.other] - Any other Axios Request Config properties to pass to the request.
   *                      See {@link https://github.com/axios/axios#request-config|Axios Request Config}   * @throws {PropertyInvalidError} method cannot be overridden
   * @return {Promise}
   * @memberof PercipioAxiosClient
   */
  options({ resource, params, data, headers, ...other }) {
    return new Promise((resolve, reject) => {
      const method = 'options';
      if (other.method &amp;&amp; other.method !== method) {
        reject(new errors.PropertyInvalidError('method cannot be overridden'));
      }

      this.sendRequest({ method, resource, params, data, headers, ...other })
        .then((response) => {
          resolve(response);
        })
        .catch((err) => {
          reject(err);
        });
    });
  }

  /**
   * Sends a patch request to the API.
   *
   * @param {Object} config
   * @param {String} config.resource - The resource path to send the request to.
   * @param {Object} [config.params={}] - The params to send with the request.
   * @param {Object} [config.data={}] - The data to send with the request.
   * @param {Object} [config.headers={}] - The headers to send with the request,
   *                                       these will be merged with the default
   *                                       headers (authorization and content-type)
   * @param {*} [config.other] - Any other Axios Request Config properties to pass to the request.
   *                      See {@link https://github.com/axios/axios#request-config|Axios Request Config}  * @throws {PropertyInvalidError} method cannot be overridden
   * @return {Promise}
   * @memberof PercipioAxiosClient
   */
  patch({ resource, params, data, headers, ...other }) {
    return new Promise((resolve, reject) => {
      const method = 'patch';
      if (other.method &amp;&amp; other.method !== method) {
        reject(new errors.PropertyInvalidError('method cannot be overridden'));
      }

      this.sendRequest({ method, resource, params, data, headers, ...other })
        .then((response) => {
          resolve(response);
        })
        .catch((err) => {
          reject(err);
        });
    });
  }

  /**
   * Sends a post request to the API.
   *
   * @param {Object} config
   * @param {String} config.resource - The resource path to send the request to.
   * @param {Object} [config.params={}] - The params to send with the request.
   * @param {Object} [config.data={}] - The data to send with the request.
   * @param {Object} [config.headers={}] - The headers to send with the request,
   *                                       these will be merged with the default
   *                                       headers (authorization and content-type)
   * @param {*} [config.other] - Any other Axios Request Config properties to pass to the request.
   *                      See {@link https://github.com/axios/axios#request-config|Axios Request Config}   * @throws {PropertyInvalidError} method cannot be overridden
   * @return {Promise}
   * @memberof PercipioAxiosClient
   */
  post({ resource, params, data, headers, ...other }) {
    return new Promise((resolve, reject) => {
      const method = 'post';
      if (other.method &amp;&amp; other.method !== method) {
        reject(new errors.PropertyInvalidError('method cannot be overridden'));
      }

      this.sendRequest({ method, resource, params, data, headers, ...other })
        .then((response) => {
          resolve(response);
        })
        .catch((err) => {
          reject(err);
        });
    });
  }

  /**
   * Sends a put request to the API.
   *
   * @param {Object} config
   * @param {String} config.resource - The resource path to send the request to.
   * @param {Object} [config.params={}] - The params to send with the request.
   * @param {Object} [config.data={}] - The data to send with the request.
   * @param {Object} [config.headers={}] - The headers to send with the request,
   *                                       these will be merged with the default
   *                                       headers (authorization and content-type)
   * @param {*} [config.other] - Any other Axios Request Config properties to pass to the request.
   *                      See {@link https://github.com/axios/axios#request-config|Axios Request Config}   * @throws {PropertyInvalidError} method cannot be overridden
   * @return {Promise}
   * @memberof PercipioAxiosClient
   */
  put({ resource, params, data, headers, ...other }) {
    return new Promise((resolve, reject) => {
      const method = 'put';
      if (other.method &amp;&amp; other.method !== method) {
        reject(new errors.PropertyInvalidError('method cannot be overridden'));
      }

      this.sendRequest({ method, resource, params, data, headers, ...other })
        .then((response) => {
          resolve(response);
        })
        .catch((err) => {
          reject(err);
        });
    });
  }
}

module.exports = {
  PercipioAxiosClient,
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.10</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
